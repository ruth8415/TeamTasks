<div class="tasks-container">
  <div class="header">
    <div class="header-left">
      <button mat-raised-button color="primary" (click)="openTaskDialog()">
        <mat-icon>add</mat-icon>
        Add Task
      </button>
    </div>
    <div class="header-right">
      @if (projectId) {
        <button mat-icon-button class="back-button" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
      }
      <h1>{{ projectId ? 'Task Board' : 'My Tasks' }}</h1>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-spinner">
      <mat-spinner></mat-spinner>
    </div>
  } @else {
    <div class="board">
      <div class="column">
        <div class="column-header todo">
          <h2>To Do</h2>
          <span class="count">{{ todoTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="todoTasks()"
          (cdkDropListDropped)="onDrop($event, 'todo')"
          [cdkDropListConnectedTo]="['in_progress_list', 'done_list']"
          id="todo_list">
          @for (task of todoTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)">
            </app-task-card>
          }
          @if (todoTasks().length === 0) {
            <div class="empty-column">
              <mat-icon>task_alt</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>

      <div class="column">
        <div class="column-header in-progress">
          <h2>In Progress</h2>
          <span class="count">{{ inProgressTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="inProgressTasks()"
          (cdkDropListDropped)="onDrop($event, 'in_progress')"
          [cdkDropListConnectedTo]="['todo_list', 'done_list']"
          id="in_progress_list">
          @for (task of inProgressTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)">
            </app-task-card>
          }
          @if (inProgressTasks().length === 0) {
            <div class="empty-column">
              <mat-icon>pending_actions</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>

      <div class="column">
        <div class="column-header done">
          <h2>Done</h2>
          <span class="count">{{ doneTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="doneTasks()"
          (cdkDropListDropped)="onDrop($event, 'done')"
          [cdkDropListConnectedTo]="['todo_list', 'in_progress_list']"
          id="done_list">
          @for (task of doneTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)">
            </app-task-card>
          }
          @if (doneTasks().length === 0) {
            <div class="empty-column">
              <mat-icon>done_all</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>